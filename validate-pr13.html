<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª PR13 - Ù†Ø§Ø¸Ø± Ú©Ù„ (Global Inspector)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Tahoma', 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            direction: rtl;
            text-align: right;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .test-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-right: 4px solid #667eea;
        }

        .test-section h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .test-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .test-item h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .test-item p {
            color: #666;
            line-height: 1.8;
            margin-bottom: 10px;
        }

        .test-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            margin: 5px;
            transition: all 0.3s;
        }

        .test-button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .test-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 400px;
            overflow-y: auto;
        }

        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .result.info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            margin: 2px;
        }

        .badge.commit {
            background: #667eea;
            color: white;
        }

        .badge.feature {
            background: #28a745;
            color: white;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-left: 8px;
        }

        .status-indicator.active {
            background: #28a745;
        }

        .status-indicator.inactive {
            background: #dc3545;
        }

        .code-block {
            background: #272822;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        pre {
            margin: 0;
            white-space: pre-wrap;
        }

        .legend {
            background: #fff3cd;
            border: 1px solid #ffeeba;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .legend h3 {
            color: #856404;
            margin-bottom: 10px;
        }

        .legend ul {
            list-style: none;
            padding-right: 20px;
        }

        .legend li {
            color: #856404;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ØªØ³Øª PR13 - Ù†Ø§Ø¸Ø± Ú©Ù„</h1>
        <p class="subtitle">Ø³ÛŒØ³ØªÙ… Ø§ÛŒÙ†Ø¯Ú©Ø³Ú¯Ø°Ø§Ø±ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ùˆ Ù¾Ø§ÛŒØ´ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡ Ø§Ú©ÙˆØ³ÛŒØ³ØªÙ…</p>

        <div class="legend">
            <h3>ğŸ¯ Ù‡Ø¯Ù PR13</h3>
            <ul>
                <li>âœ… Commit 1: HT_Global_Observer_Core - Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø±Ú©Ø²ÛŒ Ù†Ø¸Ø§Ø±Øª</li>
                <li>âœ… Commit 2: Plugin_Metadata_Extractor - Ù†Ú¯Ø§Ø´Øª Ø§Ù†Ø³Ø§Ù†ÛŒ</li>
                <li>âœ… Commit 3: Auto_KB_Synchronizer - Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±</li>
                <li>âœ… Commit 4: Admin_Observer_Settings - Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ</li>
                <li>âœ… Commit 5: Safety_Data_Sanitizer - ÙÛŒÙ„ØªØ± Ø§Ù…Ù†ÛŒØªÛŒ</li>
            </ul>
        </div>

        <!-- Test 1: Observer Status -->
        <div class="test-section">
            <h2>ØªØ³Øª 1: ÙˆØ¶Ø¹ÛŒØª Ù†Ø§Ø¸Ø± Ú©Ù„ <span class="badge commit">Commit 1</span></h2>
            <div class="test-item">
                <h3>Ø¯Ø±ÛŒØ§ÙØª Ø®Ù„Ø§ØµÙ‡ ÙˆØ¶Ø¹ÛŒØª</h3>
                <p>Ø§ÛŒÙ† ØªØ³Øª ÙˆØ¶Ø¹ÛŒØª Ú©Ù„ÛŒ Ø³ÛŒØ³ØªÙ… Ù†Ø§Ø¸Ø± Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.</p>
                <button class="test-button" onclick="testObserverStatus()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª</button>
                <div id="result-observer-status"></div>
            </div>
        </div>

        <!-- Test 2: Plugin List -->
        <div class="test-section">
            <h2>ØªØ³Øª 2: Ù„ÛŒØ³Øª Ø§ÙØ²ÙˆÙ†Ù‡â€ŒÙ‡Ø§ <span class="badge commit">Commit 1</span> <span class="badge commit">Commit 4</span></h2>
            <div class="test-item">
                <h3>Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª Ø§ÙØ²ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù†ØµØ¨ Ø´Ø¯Ù‡</h3>
                <p>Ø§ÛŒÙ† ØªØ³Øª Ù„ÛŒØ³Øª ØªÙ…Ø§Ù… Ø§ÙØ²ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù†ØµØ¨ Ø´Ø¯Ù‡ Ùˆ ÙˆØ¶Ø¹ÛŒØª Ù†Ø¸Ø§Ø±Øª Ø¢Ù†â€ŒÙ‡Ø§ Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.</p>
                <button class="test-button" onclick="testPluginsList()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª</button>
                <div id="result-plugins-list"></div>
            </div>
        </div>

        <!-- Test 3: Metadata Extraction -->
        <div class="test-section">
            <h2>ØªØ³Øª 3: Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…ØªØ§Ø¯ÛŒØªØ§ <span class="badge commit">Commit 2</span></h2>
            <div class="test-item">
                <h3>Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ùˆ Ù†Ú¯Ø§Ø´Øª Ø§Ù†Ø³Ø§Ù†ÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</h3>
                <p>Ø§ÛŒÙ† ØªØ³Øª Ù…ØªØ§Ø¯ÛŒØªØ§ÛŒ Ø§ÙØ²ÙˆÙ†Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ùˆ Ø¨Ù‡ Ù…ØªÙ† Ù‚Ø§Ø¨Ù„ ÙÙ‡Ù… ØªØ¨Ø¯ÛŒÙ„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.</p>
                <button class="test-button" onclick="testMetadataExtraction()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª</button>
                <div id="result-metadata"></div>
            </div>
        </div>

        <!-- Test 4: KB Sync -->
        <div class="test-section">
            <h2>ØªØ³Øª 4: Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Knowledge Base <span class="badge commit">Commit 3</span></h2>
            <div class="test-item">
                <h3>Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ù†Ø´</h3>
                <p>Ø§ÛŒÙ† ØªØ³Øª ÙØ±Ø¢ÛŒÙ†Ø¯ Ø±ÙØ±Ø´ Ù…ØªØ§Ø¯ÛŒØªØ§ Ùˆ Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ Knowledge Base Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.</p>
                <button class="test-button" onclick="testKBSync()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª</button>
                <div id="result-kb-sync"></div>
            </div>
        </div>

        <!-- Test 5: Recent Changes -->
        <div class="test-section">
            <h2>ØªØ³Øª 5: ØªØºÛŒÛŒØ±Ø§Øª Ø§Ø®ÛŒØ± <span class="badge commit">Commit 1</span></h2>
            <div class="test-item">
                <h3>Ø¯Ø±ÛŒØ§ÙØª Ù„Ø§Ú¯ ØªØºÛŒÛŒØ±Ø§Øª</h3>
                <p>Ø§ÛŒÙ† ØªØ³Øª Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø§Ø®ÛŒØ± Ø«Ø¨Øª Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ù†Ø§Ø¸Ø± Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.</p>
                <button class="test-button" onclick="testRecentChanges()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª</button>
                <div id="result-changes"></div>
            </div>
        </div>

        <!-- Test 6: Recent Facts -->
        <div class="test-section">
            <h2>ØªØ³Øª 6: ÙÚ©Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ø¯Ù‡ <span class="badge commit">Commit 3</span></h2>
            <div class="test-item">
                <h3>Ø¯Ø±ÛŒØ§ÙØª ÙÚ©Øªâ€ŒÙ‡Ø§ÛŒ Knowledge Base</h3>
                <p>Ø§ÛŒÙ† ØªØ³Øª ÙÚ©Øªâ€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ø§Ø² Ø§ÙØ²ÙˆÙ†Ù‡â€ŒÙ‡Ø§ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯ Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.</p>
                <button class="test-button" onclick="testRecentFacts()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª</button>
                <div id="result-facts"></div>
            </div>
        </div>

        <!-- Test 7: Data Sanitization -->
        <div class="test-section">
            <h2>ØªØ³Øª 7: ÙÛŒÙ„ØªØ± Ø§Ù…Ù†ÛŒØªÛŒ <span class="badge commit">Commit 5</span></h2>
            <div class="test-item">
                <h3>Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø§Ù†ÛŒØªØ§ÛŒØ² Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø­Ø³Ø§Ø³</h3>
                <p>Ø§ÛŒÙ† ØªØ³Øª Ù†Ù…Ø§ÛŒØ´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ Ú©Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø­Ø³Ø§Ø³ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ ÙÛŒÙ„ØªØ± Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.</p>
                <button class="test-button" onclick="testSanitization()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª</button>
                <div id="result-sanitization"></div>
            </div>
        </div>

        <!-- Test 8: Add/Remove Monitoring -->
        <div class="test-section">
            <h2>ØªØ³Øª 8: Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ø¸Ø§Ø±Øª <span class="badge commit">Commit 4</span></h2>
            <div class="test-item">
                <h3>Ø§Ø¶Ø§ÙÙ‡/Ø­Ø°Ù Ø§ÙØ²ÙˆÙ†Ù‡ Ø§Ø² Ù†Ø¸Ø§Ø±Øª</h3>
                <p>ØªÙˆØ¬Ù‡: Ø§ÛŒÙ† ØªØ³Øª ÙÙ‚Ø· Ø¯Ø± ØµÙˆØ±ØªÛŒ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ú©Ù‡ Ø§ÙØ²ÙˆÙ†Ù‡ Akismet Ù†ØµØ¨ Ø¨Ø§Ø´Ø¯.</p>
                <button class="test-button" onclick="testAddMonitoring()">Ø§Ø¶Ø§ÙÙ‡ Ø¨Ù‡ Ù†Ø¸Ø§Ø±Øª</button>
                <button class="test-button" onclick="testRemoveMonitoring()">Ø­Ø°Ù Ø§Ø² Ù†Ø¸Ø§Ø±Øª</button>
                <div id="result-monitoring"></div>
            </div>
        </div>
    </div>

    <script>
        // ØªÙ†Ø¸ÛŒÙ…Ø§Øª API
        const API_BASE = '/wp-json/homaye/v1';
        let wpNonce = '';

        // Ø¯Ø±ÛŒØ§ÙØª nonce Ø§Ø² WordPress
        function getWPNonce() {
            // Ø¯Ø± Ù…Ø­ÛŒØ· ÙˆØ§Ù‚Ø¹ÛŒ WordPressØŒ nonce Ø§Ø² localized script Ø¢Ù…Ø¯Ù‡
            // Ø¨Ø±Ø§ÛŒ ØªØ³ØªØŒ Ø§Ø² cookie ÛŒØ§ Ù…ØªØºÛŒØ± global Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
            if (typeof wpApiSettings !== 'undefined') {
                return wpApiSettings.nonce;
            }
            return '';
        }

        wpNonce = getWPNonce();

        // ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬
        function showResult(elementId, data, type = 'info') {
            const resultDiv = document.getElementById(elementId);
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
        }

        // ØªØ³Øª 1: ÙˆØ¶Ø¹ÛŒØª Ù†Ø§Ø¸Ø±
        async function testObserverStatus() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...';

            try {
                const response = await fetch(API_BASE + '/observer/status', {
                    method: 'GET',
                    headers: {
                        'X-WP-Nonce': wpNonce
                    }
                });

                const data = await response.json();
                
                if (data.success) {
                    showResult('result-observer-status', {
                        'âœ… ØªØ¹Ø¯Ø§Ø¯ Ø§ÙØ²ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ­Øª Ù†Ø¸Ø±': data.data.monitored_count,
                        'âœ… Ø§ÙØ²ÙˆÙ†Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„': data.data.active_count,
                        'âœ… Ø¢Ø®Ø±ÛŒÙ† Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ': data.data.last_sync,
                        'Ø¬Ø²Ø¦ÛŒØ§Øª': data.data
                    }, 'success');
                } else {
                    showResult('result-observer-status', data, 'error');
                }
            } catch (error) {
                showResult('result-observer-status', {error: error.message}, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª';
            }
        }

        // ØªØ³Øª 2: Ù„ÛŒØ³Øª Ø§ÙØ²ÙˆÙ†Ù‡â€ŒÙ‡Ø§
        async function testPluginsList() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...';

            try {
                const response = await fetch(API_BASE + '/observer/plugins', {
                    method: 'GET',
                    headers: {
                        'X-WP-Nonce': wpNonce
                    }
                });

                const data = await response.json();
                
                if (data.success) {
                    const plugins = data.data.map(p => ({
                        Ù†Ø§Ù…: p.name,
                        Ù†Ø³Ø®Ù‡: p.version,
                        ÙØ¹Ø§Ù„: p.is_active ? 'âœ…' : 'âŒ',
                        'ØªØ­Øª Ù†Ø¸Ø±': p.is_monitored ? 'âœ…' : 'â–'
                    }));
                    
                    showResult('result-plugins-list', {
                        'ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„': data.data.length,
                        'Ø§ÙØ²ÙˆÙ†Ù‡â€ŒÙ‡Ø§': plugins.slice(0, 10) // ÙÙ‚Ø· 10 ØªØ§ÛŒ Ø§ÙˆÙ„
                    }, 'success');
                } else {
                    showResult('result-plugins-list', data, 'error');
                }
            } catch (error) {
                showResult('result-plugins-list', {error: error.message}, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª';
            }
        }

        // ØªØ³Øª 3: Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…ØªØ§Ø¯ÛŒØªØ§
        async function testMetadataExtraction() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...';

            try {
                const response = await fetch(API_BASE + '/observer/metadata', {
                    method: 'GET',
                    headers: {
                        'X-WP-Nonce': wpNonce
                    }
                });

                const data = await response.json();
                
                if (data.success) {
                    const summary = {};
                    for (const [slug, metadata] of Object.entries(data.data)) {
                        summary[slug] = {
                            'ØªØ§Ø±ÛŒØ® Ø§Ø³ØªØ®Ø±Ø§Ø¬': metadata.extraction_time,
                            'ØªØ¹Ø¯Ø§Ø¯ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ù†Ø³Ø§Ù†ÛŒ': metadata.options_human ? Object.keys(metadata.options_human).length : 0,
                            'Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§': metadata.capabilities?.features || []
                        };
                    }
                    
                    showResult('result-metadata', {
                        'ØªØ¹Ø¯Ø§Ø¯ Ø§ÙØ²ÙˆÙ†Ù‡â€ŒÙ‡Ø§': Object.keys(data.data).length,
                        'Ø®Ù„Ø§ØµÙ‡': summary
                    }, 'success');
                } else {
                    showResult('result-metadata', data, 'error');
                }
            } catch (error) {
                showResult('result-metadata', {error: error.message}, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª';
            }
        }

        // ØªØ³Øª 4: Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ KB
        async function testKBSync() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...';

            try {
                const response = await fetch(API_BASE + '/observer/refresh', {
                    method: 'POST',
                    headers: {
                        'X-WP-Nonce': wpNonce
                    }
                });

                const data = await response.json();
                
                if (data.success) {
                    showResult('result-kb-sync', {
                        'âœ… ÙˆØ¶Ø¹ÛŒØª': data.message,
                        'ØªØ¹Ø¯Ø§Ø¯ Ø§ÙØ²ÙˆÙ†Ù‡â€ŒÙ‡Ø§': data.data.plugins_count,
                        'Ø¢Ø®Ø±ÛŒÙ† Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ': data.data.last_sync
                    }, 'success');
                } else {
                    showResult('result-kb-sync', data, 'error');
                }
            } catch (error) {
                showResult('result-kb-sync', {error: error.message}, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª';
            }
        }

        // ØªØ³Øª 5: ØªØºÛŒÛŒØ±Ø§Øª Ø§Ø®ÛŒØ±
        async function testRecentChanges() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...';

            try {
                const response = await fetch(API_BASE + '/observer/changes', {
                    method: 'GET',
                    headers: {
                        'X-WP-Nonce': wpNonce
                    }
                });

                const data = await response.json();
                
                if (data.success) {
                    showResult('result-changes', {
                        'ØªØ¹Ø¯Ø§Ø¯ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§': data.data.length,
                        'Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø§Ø®ÛŒØ±': data.data.slice(0, 10).map(e => ({
                            Ù†ÙˆØ¹: e.event_type,
                            Ø²Ù…Ø§Ù†: e.created_at
                        }))
                    }, 'success');
                } else {
                    showResult('result-changes', data, 'error');
                }
            } catch (error) {
                showResult('result-changes', {error: error.message}, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª';
            }
        }

        // ØªØ³Øª 6: ÙÚ©Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ±
        async function testRecentFacts() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...';

            try {
                const response = await fetch(API_BASE + '/observer/facts', {
                    method: 'GET',
                    headers: {
                        'X-WP-Nonce': wpNonce
                    }
                });

                const data = await response.json();
                
                if (data.success) {
                    showResult('result-facts', {
                        'ØªØ¹Ø¯Ø§Ø¯ ÙÚ©Øªâ€ŒÙ‡Ø§': data.data.length,
                        'ÙÚ©Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ±': data.data.slice(0, 10).map(f => ({
                            ÙÚ©Øª: f.fact,
                            Ø¯Ø³ØªÙ‡: f.category,
                            Ø²Ù…Ø§Ù†: f.created_at
                        }))
                    }, 'success');
                } else {
                    showResult('result-facts', data, 'error');
                }
            } catch (error) {
                showResult('result-facts', {error: error.message}, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª';
            }
        }

        // ØªØ³Øª 7: Ø³Ø§Ù†ÛŒØªØ§ÛŒØ²ÛŒØ´Ù†
        function testSanitization() {
            const testData = {
                'Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³Øª': {
                    'api_key': 'sk_test_123456789',
                    'password': 'mypassword123',
                    'email': 'test@example.com',
                    'normal_setting': 'Ø§ÛŒÙ† ÛŒÚ© ØªÙ†Ø¸ÛŒÙ… Ø¹Ø§Ø¯ÛŒ Ø§Ø³Øª',
                    'woocommerce_currency': 'IRR'
                },
                'Ù†ØªÛŒØ¬Ù‡ Ø§Ù†ØªØ¸Ø§Ø±ÛŒ': {
                    'api_key': '[FILTERED]',
                    'password': '[FILTERED]',
                    'email': '[EMAIL_FILTERED]',
                    'normal_setting': 'Ø§ÛŒÙ† ÛŒÚ© ØªÙ†Ø¸ÛŒÙ… Ø¹Ø§Ø¯ÛŒ Ø§Ø³Øª',
                    'woocommerce_currency': 'IRR'
                },
                'ØªÙˆØ¶ÛŒØ­Ø§Øª': 'Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ø­Ø³Ø§Ø³ Ùˆ Ø§ÛŒÙ…ÛŒÙ„â€ŒÙ‡Ø§ Ø¨Ø§ÛŒØ¯ ÙÛŒÙ„ØªØ± Ø´ÙˆÙ†Ø¯'
            };

            showResult('result-sanitization', testData, 'info');
        }

        // ØªØ³Øª 8: Ø§Ø¶Ø§ÙÙ‡ Ø¨Ù‡ Ù†Ø¸Ø§Ø±Øª
        async function testAddMonitoring() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...';

            try {
                const response = await fetch(API_BASE + '/observer/monitor/add', {
                    method: 'POST',
                    headers: {
                        'X-WP-Nonce': wpNonce,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        plugin_path: 'akismet/akismet.php'
                    })
                });

                const data = await response.json();
                showResult('result-monitoring', data, data.success ? 'success' : 'error');
            } catch (error) {
                showResult('result-monitoring', {error: error.message}, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Ø§Ø¶Ø§ÙÙ‡ Ø¨Ù‡ Ù†Ø¸Ø§Ø±Øª';
            }
        }

        // ØªØ³Øª 8: Ø­Ø°Ù Ø§Ø² Ù†Ø¸Ø§Ø±Øª
        async function testRemoveMonitoring() {
            const btn = event.target;
            btn.disabled = true;
            btn.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...';

            try {
                const response = await fetch(API_BASE + '/observer/monitor/remove', {
                    method: 'POST',
                    headers: {
                        'X-WP-Nonce': wpNonce,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        plugin_path: 'akismet/akismet.php'
                    })
                });

                const data = await response.json();
                showResult('result-monitoring', data, data.success ? 'success' : 'error');
            } catch (error) {
                showResult('result-monitoring', {error: error.message}, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Ø­Ø°Ù Ø§Ø² Ù†Ø¸Ø§Ø±Øª';
            }
        }
    </script>
</body>
</html>
